<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#00d9ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–°–º–µ–Ω—ã">
    <link rel="apple-touch-icon" href="/icon-192.png">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW error:', err));
            });
        }
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: #fff;
            overflow-x: hidden;
        }

        /* ==================== LOGIN SCREEN ==================== */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 20px;
        }

        .login-box {
            background: rgba(255,255,255,0.1);
            padding: 40px 25px;
            border-radius: 20px;
            width: 100%;
            max-width: 380px;
            backdrop-filter: blur(10px);
        }

        .login-box h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .login-box p {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 16px;
        }

        .form-group input:focus {
            outline: 2px solid #00d9ff;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            color: #1a1a2e;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
        }

        .login-error {
            background: rgba(255, 71, 87, 0.2);
            color: #ff6b6b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        /* ==================== MAIN APP ==================== */
        .app-screen {
            display: none;
            padding: 10px;
            padding-bottom: 70px;
        }

        .app-screen.active {
            display: block;
        }

        .login-screen.hidden {
            display: none;
        }

        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 5px 0;
        }

        .app-header h1 {
            font-size: 1.3rem;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-badge {
            background: rgba(0, 217, 255, 0.2);
            color: #00d9ff;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
        }

        .logout-btn {
            background: rgba(255, 71, 87, 0.2);
            color: #ff6b6b;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-size: 0.75rem;
            color: #aaa;
            white-space: nowrap;
        }

        input, select, button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }

        input, select {
            background: rgba(255,255,255,0.15);
            color: #fff;
        }

        button {
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-excel {
            background: linear-gradient(135deg, #2ed573, #1e90ff);
            font-size: 0.8rem;
            padding: 8px 15px;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #576574, #8395a7);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #ff6b81);
        }

        /* Main content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 12px;
        }

        .sidebar h2 {
            font-size: 0.95rem;
            margin-bottom: 10px;
            color: #00d9ff;
        }

        .add-employee {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .add-employee input {
            flex: 1;
            min-width: 0;
            padding: 10px 12px;
        }

        .add-employee button {
            padding: 10px 15px;
            font-size: 1.1rem;
        }

        .employee-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 200px;
            overflow-y: auto;
        }

        .employee-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.1);
            padding: 10px 12px;
            border-radius: 8px;
        }

        .employee-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .employee-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .delete-btn {
            background: transparent;
            color: #ff4757;
            padding: 5px 10px;
            font-size: 1.1rem;
        }

        /* ==================== CALENDAR - MOBILE OPTIMIZED ==================== */
        .calendar-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 12px;
            overflow: hidden;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .calendar-header h2 {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .calendar-header button {
            padding: 8px 15px;
            font-size: 1rem;
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞ */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.65rem;
        }

        .legend-color {
            width: 16px;
            height: 14px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5rem;
            font-weight: bold;
        }

        /* –ú–æ–±–∏–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å - –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –¥–Ω—è–º */
        .mobile-calendar {
            display: none;
        }

        .day-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .day-card-header {
            background: rgba(0, 217, 255, 0.15);
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .day-card-header.weekend {
            background: rgba(255, 71, 87, 0.15);
        }

        .day-card-header.today {
            background: rgba(0, 255, 136, 0.2);
            border-left: 3px solid #00ff88;
        }

        .day-card-header .date {
            font-size: 1rem;
        }

        .day-card-header .weekday {
            font-size: 0.8rem;
            color: #aaa;
        }

        .day-card-body {
            padding: 8px;
        }

        .day-employee-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            margin: 4px 0;
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            cursor: pointer;
        }

        .day-employee-row:active {
            opacity: 0.7;
        }

        .day-employee-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .day-shift-value {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 45px;
            text-align: center;
        }

        .day-shift-value.empty {
            background: rgba(255,255,255,0.1);
            color: #666;
        }

        /* –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ */
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            min-width: max-content;
        }

        .schedule-table th,
        .schedule-table td {
            padding: 5px 3px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .schedule-table th {
            background: rgba(0, 217, 255, 0.2);
            font-size: 0.7rem;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .schedule-table th:first-child,
        .schedule-table td:first-child {
            position: sticky;
            left: 0;
            z-index: 15;
            background: rgba(26, 26, 46, 0.98);
        }

        .schedule-table th:first-child {
            z-index: 20;
            background: rgba(0, 100, 150, 0.9);
        }

        .schedule-table th.weekend {
            background: rgba(255, 71, 87, 0.2);
        }

        .schedule-table td.weekend {
            background: rgba(255, 71, 87, 0.05);
        }

        .schedule-table td.employee-name {
            text-align: left;
            font-size: 0.75rem;
            min-width: 80px;
            max-width: 100px;
            padding: 5px 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .shift-cell {
            cursor: pointer;
            min-width: 32px;
            height: 30px;
            font-size: 0.6rem;
            font-weight: 600;
        }

        .shift-cell.readonly {
            cursor: default;
        }

        .shift-work { background: linear-gradient(135deg, #00d9ff, #00a8cc) !important; color: #1a1a2e; }
        .shift-work-cleaning { background: linear-gradient(135deg, #a29bfe, #6c5ce7) !important; color: #fff; }
        .shift-work-fullCleaning { background: linear-gradient(135deg, #fd79a8, #e84393) !important; color: #fff; }
        .shift-off { background: linear-gradient(135deg, #576574, #222f3e) !important; color: #fff; }
        .shift-vacation { background: linear-gradient(135deg, #00ff88, #00b894) !important; color: #1a1a2e; }
        .shift-sick { background: linear-gradient(135deg, #ff4757, #c0392b) !important; color: #fff; }

        .today { box-shadow: inset 0 0 0 2px #00ff88; }

        /* Stats */
        .stats-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 12px;
        }

        .stats-section h2 {
            margin-bottom: 12px;
            color: #00d9ff;
            font-size: 0.95rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 12px 8px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 0.65rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .stat-card .value {
            font-size: 1.3rem;
            font-weight: bold;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
        }

        .stats-table th,
        .stats-table td {
            padding: 8px 5px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stats-table th {
            background: rgba(0, 217, 255, 0.1);
            font-size: 0.7rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: flex-end;
            z-index: 1000;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: #1a1a2e;
            padding: 20px 15px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-content h3 {
            text-align: center;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .modal-info {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 15px;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .work-shift-form {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .modal-section-title {
            text-align: center;
            color: #aaa;
            margin-bottom: 12px;
            font-size: 0.85rem;
        }

        .hours-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .hours-row input {
            width: 90px;
            text-align: center;
            font-size: 1.5rem;
            padding: 12px;
            font-weight: bold;
        }

        .hours-row span {
            color: #aaa;
            font-size: 1rem;
        }

        .cleaning-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .cleaning-option {
            padding: 12px 8px;
            border-radius: 10px;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            font-size: 0.85rem;
            text-align: center;
        }

        .cleaning-option.active {
            border-color: #00d9ff;
            background: rgba(0, 217, 255, 0.2);
        }

        .cleaning-option.cleaning.active {
            border-color: #6c5ce7;
            background: rgba(162, 155, 254, 0.3);
        }

        .cleaning-option.fullCleaning.active {
            border-color: #e84393;
            background: rgba(253, 121, 168, 0.3);
        }

        .save-work-btn {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
        }

        .divider {
            text-align: center;
            color: #444;
            margin: 15px 0;
            font-size: 0.8rem;
        }

        .other-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .other-option {
            padding: 14px 8px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 0.8rem;
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .modal-buttons button {
            padding: 14px;
        }

        /* Mobile tabs */
        .mobile-tabs {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.98);
            padding: 8px 0;
            padding-bottom: calc(8px + env(safe-area-inset-bottom));
            z-index: 100;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .mobile-tabs-inner {
            display: flex;
            justify-content: space-around;
        }

        .mobile-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 15px;
            color: #666;
            font-size: 0.65rem;
            cursor: pointer;
            border: none;
            background: none;
            transition: color 0.2s;
        }

        .mobile-tab.active { 
            color: #00d9ff; 
        }
        
        .mobile-tab-icon { 
            font-size: 1.4rem; 
            margin-bottom: 2px; 
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, #2ed573, #1e90ff);
            color: #fff;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.9rem;
            transition: transform 0.3s;
            z-index: 2000;
            white-space: nowrap;
        }

        .toast.show { transform: translateX(-50%) translateY(0); }
        .toast.error { background: linear-gradient(135deg, #ff4757, #c0392b); }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
        }

        .spinner {
            width: 35px;
            height: 35px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #00d9ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* View toggle */
        .view-toggle {
            display: none;
            gap: 5px;
            margin-bottom: 12px;
        }

        .view-toggle button {
            flex: 1;
            padding: 10px;
            font-size: 0.8rem;
            background: rgba(255,255,255,0.1);
            color: #aaa;
        }

        .view-toggle button.active {
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            color: #1a1a2e;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .mobile-tabs { display: block; }
            .section.hidden-mobile { display: none; }
            
            .view-toggle { display: flex; }
            
            .mobile-calendar.active { display: block; }
            .table-wrapper.hidden { display: none; }
            
            .main-content {
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .controls {
                justify-content: space-between;
            }

            .control-group {
                flex: 1;
                min-width: 0;
                justify-content: center;
            }

            #monthPicker {
                width: 100%;
                max-width: 140px;
            }

            .other-options {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 769px) {
            .app-screen {
                padding: 20px;
                padding-bottom: 30px;
            }

            .main-content {
                display: grid;
                grid-template-columns: 260px 1fr;
            }

            .modal { align-items: center; }
            .modal-content { 
                border-radius: 20px; 
                max-height: 90vh;
            }

            .calendar-header h2 {
                font-size: 1.3rem;
            }

            .stats-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        @media (min-width: 1200px) {
            .shift-cell {
                min-width: 38px;
                height: 34px;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>üìÖ –ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</h1>
            <p>–í–æ–π–¥–∏—Ç–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</p>
            
            <div class="login-error" id="loginError"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="loginUsername" placeholder="admin" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
                </div>
                <button type="submit" class="login-btn">–í–æ–π—Ç–∏</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-screen" id="appScreen">
        <header class="app-header">
            <h1>üìÖ –ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</h1>
            <div class="user-info">
                <span class="user-badge" id="userBadge">–ê–¥–º–∏–Ω</span>
                <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </header>

        <div class="controls">
            <div class="control-group">
                <label>–ú–µ—Å—è—Ü</label>
                <input type="month" id="monthPicker">
            </div>
            <div class="control-group" id="defaultHoursControl">
                <label>–ß–∞—Å–æ–≤</label>
                <input type="number" id="defaultHours" min="1" max="24" value="10" style="width: 60px; text-align: center;">
            </div>
            <button onclick="exportToExcel()" class="btn-excel">üìä Excel</button>
        </div>

        <div class="main-content">
            <aside class="sidebar section" id="sectionEmployees">
                <h2>üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
                <div class="add-employee" id="addEmployeeForm">
                    <input type="text" id="newEmployeeName" placeholder="–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞">
                    <button onclick="addEmployee()">+</button>
                </div>
                <div class="employee-list" id="employeeList">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </aside>

            <main class="calendar-section section" id="sectionCalendar">
                <div class="calendar-header">
                    <button onclick="changeMonth(-1)">‚óÄ</button>
                    <h2 id="currentMonthDisplay"></h2>
                    <button onclick="changeMonth(1)">‚ñ∂</button>
                </div>

                <div class="legend">
                    <div class="legend-item"><div class="legend-color shift-work">10</div><span>–ß–∞—Å—ã</span></div>
                    <div class="legend-item"><div class="legend-color shift-work-cleaning">–£</div><span>–£–±–æ—Ä–∫–∞</span></div>
                    <div class="legend-item"><div class="legend-color shift-work-fullCleaning">–£1</div><span>–ü–æ–ª–Ω.</span></div>
                    <div class="legend-item"><div class="legend-color shift-off">–í</div><span>–í—ã—Ö</span></div>
                    <div class="legend-item"><div class="legend-color shift-vacation">–û</div><span>–û—Ç–ø</span></div>
                    <div class="legend-item"><div class="legend-color shift-sick">–ë</div><span>–ë–æ–ª</span></div>
                </div>

                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∞ -->
                <div class="view-toggle">
                    <button class="active" onclick="setView('cards')">üìã –ö–∞—Ä—Ç–æ—á–∫–∏</button>
                    <button onclick="setView('table')">üìä –¢–∞–±–ª–∏—Ü–∞</button>
                </div>

                <!-- –ú–æ–±–∏–ª—å–Ω—ã–π –≤–∏–¥ - –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –¥–Ω—è–º -->
                <div class="mobile-calendar active" id="mobileCalendar"></div>

                <!-- –î–µ—Å–∫—Ç–æ–ø–Ω—ã–π –≤–∏–¥ - —Ç–∞–±–ª–∏—Ü–∞ -->
                <div class="table-wrapper hidden" id="tableWrapper">
                    <table class="schedule-table">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </main>
        </div>

        <section class="stats-section section" id="sectionStats">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats-grid" id="statsGrid"></div>
            <div class="table-wrapper">
                <table class="stats-table">
                    <thead>
                        <tr><th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th><th>–°–º–µ–Ω</th><th>–ß–∞—Å–æ–≤</th><th>–£</th><th>–£1</th><th>–í</th><th>–û</th><th>–ë</th></tr>
                    </thead>
                    <tbody id="statsTableBody"></tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Mobile Tabs -->
    <nav class="mobile-tabs" id="mobileTabs">
        <div class="mobile-tabs-inner">
            <button class="mobile-tab active" onclick="showSection('calendar')">
                <span class="mobile-tab-icon">üìÖ</span><span>–ì—Ä–∞—Ñ–∏–∫</span>
            </button>
            <button class="mobile-tab" onclick="showSection('employees')">
                <span class="mobile-tab-icon">üë•</span><span>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</span>
            </button>
            <button class="mobile-tab" onclick="showSection('stats')">
                <span class="mobile-tab-icon">üìä</span><span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
            </button>
        </div>
    </nav>

    <!-- Shift Modal -->
    <div class="modal" id="shiftModal">
        <div class="modal-content">
            <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
            <div class="modal-info" id="modalInfo"></div>
            
            <div class="work-shift-form">
                <div class="modal-section-title">‚è∞ –†–∞–±–æ—á–∞—è —Å–º–µ–Ω–∞</div>
                <div class="hours-row">
                    <input type="number" id="modalHours" min="1" max="24" value="10" inputmode="numeric">
                    <span>—á–∞—Å–æ–≤</span>
                </div>
                <div class="cleaning-options">
                    <div class="cleaning-option none active" onclick="selectCleaning('none')">–ë–µ–∑ —É–±–æ—Ä–∫–∏</div>
                    <div class="cleaning-option cleaning" onclick="selectCleaning('cleaning')">üßπ –£</div>
                    <div class="cleaning-option fullCleaning" onclick="selectCleaning('fullCleaning')">üßΩ –£1</div>
                </div>
                <button class="save-work-btn" onclick="saveWorkShift()">‚úì –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>

            <div class="divider">‚Äî –∏–ª–∏ –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ ‚Äî</div>

            <div class="other-options">
                <div class="other-option shift-off" onclick="setDayType('off')">üè† –í—ã—Ö–æ–¥–Ω–æ–π</div>
                <div class="other-option shift-vacation" onclick="setDayType('vacation')">üèñÔ∏è –û—Ç–ø—É—Å–∫</div>
                <div class="other-option shift-sick" onclick="setDayType('sick')">üè• –ë–æ–ª—å–Ω–∏—á–Ω—ã–π</div>
            </div>
            
            <div class="modal-buttons">
                <button class="btn-danger" onclick="clearShift()">‚úñ –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const API_URL = '';
        
        let currentUser = null;
        let token = null;
        let employees = [];
        let shifts = {};
        let settings = { defaultHours: 10 };
        let currentDate = new Date();
        let selectedCell = null;
        let selectedCleaning = 'none';
        let isMobile = window.innerWidth <= 768;
        let currentView = 'cards';

        const monthNames = ['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'];
        const monthNamesShort = ['–Ø–Ω–≤','–§–µ–≤','–ú–∞—Ä','–ê–ø—Ä','–ú–∞–π','–ò—é–Ω','–ò—é–ª','–ê–≤–≥','–°–µ–Ω','–û–∫—Ç','–ù–æ—è','–î–µ–∫'];
        const dayNames = ['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];
        const dayNamesFull = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ','–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–í—Ç–æ—Ä–Ω–∏–∫','–°—Ä–µ–¥–∞','–ß–µ—Ç–≤–µ—Ä–≥','–ü—è—Ç–Ω–∏—Ü–∞','–°—É–±–±–æ—Ç–∞'];

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            initMonthPicker();
            window.addEventListener('resize', handleResize);
            handleResize();
        });

        function handleResize() {
            const wasMobile = isMobile;
            isMobile = window.innerWidth <= 768;
            
            if (!isMobile) {
                document.querySelectorAll('.section').forEach(s => s.classList.remove('hidden-mobile'));
                setView('table');
            } else if (!wasMobile && isMobile) {
                setView('cards');
            }
        }

        function setView(view) {
            currentView = view;
            const cards = document.getElementById('mobileCalendar');
            const table = document.getElementById('tableWrapper');
            const buttons = document.querySelectorAll('.view-toggle button');
            
            buttons.forEach(b => b.classList.remove('active'));
            
            if (view === 'cards') {
                cards.classList.add('active');
                table.classList.add('hidden');
                buttons[0].classList.add('active');
            } else {
                cards.classList.remove('active');
                table.classList.remove('hidden');
                buttons[1].classList.add('active');
            }
        }

        // ==================== AUTH ====================
        async function checkAuth() {
            token = localStorage.getItem('token');
            if (!token) { showLogin(); return; }

            try {
                const res = await api('/api/auth/verify');
                currentUser = res.user;
                showApp();
            } catch (e) {
                localStorage.removeItem('token');
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('appScreen').classList.remove('active');
            document.getElementById('mobileTabs').style.display = 'none';
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.add('active');
            if (isMobile) document.getElementById('mobileTabs').style.display = 'block';
            
            document.getElementById('userBadge').textContent = currentUser.name;
            loadData();
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            try {
                const res = await fetch(API_URL + '/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await res.json();
                
                if (!res.ok) {
                    errorDiv.textContent = data.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
                    errorDiv.style.display = 'block';
                    return;
                }

                token = data.token;
                currentUser = data.user;
                localStorage.setItem('token', token);
                errorDiv.style.display = 'none';
                showApp();
            } catch (e) {
                errorDiv.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                errorDiv.style.display = 'block';
            }
        });

        function logout() {
            localStorage.removeItem('token');
            token = null;
            currentUser = null;
            showLogin();
        }

        // ==================== API ====================
        async function api(endpoint, options = {}) {
            const res = await fetch(API_URL + endpoint, {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                    ...options.headers
                }
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞');
            return data;
        }

        // ==================== DATA ====================
        async function loadData() {
            try {
                [employees, shifts, settings] = await Promise.all([
                    api('/api/employees'),
                    api('/api/shifts'),
                    api('/api/settings')
                ]);
                document.getElementById('defaultHours').value = settings.defaultHours || 10;
                render();
            } catch (e) {
                showToast('–û—à–∏–±–∫–∞: ' + e.message, true);
            }
        }

        // ==================== EMPLOYEES ====================
        async function addEmployee() {
            const input = document.getElementById('newEmployeeName');
            const name = input.value.trim();
            if (!name) return;

            try {
                const emp = await api('/api/employees', {
                    method: 'POST',
                    body: JSON.stringify({ name })
                });
                employees.push(emp);
                input.value = '';
                render();
                showToast('‚úì ' + name);
            } catch (e) {
                showToast(e.message, true);
            }
        }

        async function deleteEmployee(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?')) return;
            try {
                await api('/api/employees/' + id, { method: 'DELETE' });
                employees = employees.filter(e => e.id !== id);
                Object.keys(shifts).filter(k => k.startsWith(id + '_')).forEach(k => delete shifts[k]);
                render();
                showToast('–£–¥–∞–ª–µ–Ω–æ');
            } catch (e) {
                showToast(e.message, true);
            }
        }

        document.getElementById('newEmployeeName').addEventListener('keypress', e => {
            if (e.key === 'Enter') addEmployee();
        });

        // ==================== SHIFTS ====================
        async function saveShift(key, data) {
            try {
                await api('/api/shifts', { method: 'POST', body: JSON.stringify({ key, data }) });
                if (data === null) delete shifts[key];
                else shifts[key] = data;
                render();
            } catch (e) {
                showToast(e.message, true);
            }
        }

        async function saveWorkShift() {
            if (!selectedCell) return;
            const hours = parseInt(document.getElementById('modalHours').value) || 10;
            const key = `${selectedCell.empId}_${selectedCell.year}-${selectedCell.month}-${selectedCell.day}`;
            await saveShift(key, { type: 'work', hours, cleaning: selectedCleaning === 'none' ? null : selectedCleaning });
            closeModal();
        }

        async function setDayType(type) {
            if (!selectedCell) return;
            const key = `${selectedCell.empId}_${selectedCell.year}-${selectedCell.month}-${selectedCell.day}`;
            await saveShift(key, { type });
            closeModal();
        }

        async function clearShift() {
            if (!selectedCell) return;
            const key = `${selectedCell.empId}_${selectedCell.year}-${selectedCell.month}-${selectedCell.day}`;
            await saveShift(key, null);
            closeModal();
        }

        // ==================== SETTINGS ====================
        document.getElementById('defaultHours').addEventListener('change', async function() {
            try {
                settings.defaultHours = parseInt(this.value) || 10;
                await api('/api/settings', { method: 'POST', body: JSON.stringify({ defaultHours: settings.defaultHours }) });
            } catch (e) { showToast(e.message, true); }
        });

        // ==================== RENDER ====================
        function render() {
            renderEmployeeList();
            renderCalendar();
            renderMobileCalendar();
            renderStats();
        }

        function renderEmployeeList() {
            const list = document.getElementById('employeeList');
            if (!employees.length) {
                list.innerHTML = '<p style="color:#666;text-align:center;padding:15px;font-size:0.85rem">–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>';
                return;
            }
            list.innerHTML = employees.map(e => `
                <div class="employee-item">
                    <div class="employee-info">
                        <div class="employee-color" style="background:${e.color}"></div>
                        <span>${e.name}</span>
                    </div>
                    <button class="delete-btn" onclick="deleteEmployee('${e.id}')">√ó</button>
                </div>
            `).join('');
        }

        function initMonthPicker() {
            const picker = document.getElementById('monthPicker');
            picker.value = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
            picker.addEventListener('change', function() {
                const [y, m] = this.value.split('-');
                currentDate = new Date(y, m - 1, 1);
                render();
            });
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            document.getElementById('monthPicker').value = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
            render();
        }

        function getDaysInMonth(y, m) { return new Date(y, m + 1, 0).getDate(); }
        function getDayOfWeek(y, m, d) { return new Date(y, m, d).getDay(); }

        function getShiftDisplay(data) {
            if (!data) return { label: '', class: '', full: '‚Äî' };
            if (data.type === 'work') {
                let label = data.hours.toString();
                let cls = 'shift-work';
                let full = data.hours + '—á';
                if (data.cleaning === 'cleaning') { label += '/–£'; cls = 'shift-work-cleaning'; full += ' +–£'; }
                else if (data.cleaning === 'fullCleaning') { label += '/–£1'; cls = 'shift-work-fullCleaning'; full += ' +–£1'; }
                return { label, class: cls, full };
            }
            const map = {
                'off': { label: '–í', class: 'shift-off', full: '–í—ã—Ö–æ–¥–Ω–æ–π' },
                'vacation': { label: '–û', class: 'shift-vacation', full: '–û—Ç–ø—É—Å–∫' },
                'sick': { label: '–ë', class: 'shift-sick', full: '–ë–æ–ª—å–Ω–∏—á–Ω—ã–π' }
            };
            return map[data.type] || { label: '', class: '', full: '‚Äî' };
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const days = getDaysInMonth(year, month);
            const today = new Date();

            document.getElementById('currentMonthDisplay').textContent = 
                isMobile ? `${monthNamesShort[month]} ${year}` : `${monthNames[month]} ${year}`;

            let head = '<tr><th>–ò–º—è</th>';
            for (let d = 1; d <= days; d++) {
                const dow = getDayOfWeek(year, month, d);
                const isWeekend = dow === 0 || dow === 6;
                const isToday = today.getDate() === d && today.getMonth() === month && today.getFullYear() === year;
                head += `<th class="${isWeekend ? 'weekend' : ''} ${isToday ? 'today' : ''}">${d}<br><small>${dayNames[dow]}</small></th>`;
            }
            head += '<th>Œ£</th></tr>';
            document.getElementById('tableHead').innerHTML = head;

            if (!employees.length) {
                document.getElementById('tableBody').innerHTML = `<tr><td colspan="${days + 2}" style="text-align:center;padding:25px;color:#666">–î–æ–±–∞–≤—å—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</td></tr>`;
                return;
            }

            let body = '';
            employees.forEach(emp => {
                body += `<tr><td class="employee-name"><span style="color:${emp.color}">‚óè</span> ${emp.name}</td>`;
                let total = 0;
                for (let d = 1; d <= days; d++) {
                    const dow = getDayOfWeek(year, month, d);
                    const isWeekend = dow === 0 || dow === 6;
                    const isToday = today.getDate() === d && today.getMonth() === month && today.getFullYear() === year;
                    const key = `${emp.id}_${year}-${month}-${d}`;
                    const shift = shifts[key];
                    const disp = getShiftDisplay(shift);
                    if (shift?.type === 'work') total += shift.hours;
                    
                    body += `<td class="shift-cell ${disp.class} ${isWeekend ? 'weekend' : ''} ${isToday ? 'today' : ''}" 
                        onclick="openShiftModal('${emp.id}',${year},${month},${d})">${disp.label}</td>`;
                }
                body += `<td><strong>${total}</strong></td></tr>`;
            });
            document.getElementById('tableBody').innerHTML = body;
        }

        function renderMobileCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const days = getDaysInMonth(year, month);
            const today = new Date();

            if (!employees.length) {
                document.getElementById('mobileCalendar').innerHTML = '<p style="text-align:center;padding:30px;color:#666">–î–æ–±–∞–≤—å—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>';
                return;
            }

            let html = '';
            for (let d = 1; d <= days; d++) {
                const dow = getDayOfWeek(year, month, d);
                const isWeekend = dow === 0 || dow === 6;
                const isToday = today.getDate() === d && today.getMonth() === month && today.getFullYear() === year;

                let headerClass = isToday ? 'today' : (isWeekend ? 'weekend' : '');
                
                html += `<div class="day-card">
                    <div class="day-card-header ${headerClass}">
                        <span class="date">${d} ${monthNamesShort[month]}</span>
                        <span class="weekday">${dayNamesFull[dow]}</span>
                    </div>
                    <div class="day-card-body">`;

                employees.forEach(emp => {
                    const key = `${emp.id}_${year}-${month}-${d}`;
                    const shift = shifts[key];
                    const disp = getShiftDisplay(shift);
                    
                    html += `<div class="day-employee-row" onclick="openShiftModal('${emp.id}',${year},${month},${d})">
                        <div class="day-employee-name">
                            <div class="employee-color" style="background:${emp.color}"></div>
                            <span>${emp.name}</span>
                        </div>
                        <div class="day-shift-value ${disp.class || 'empty'}">${disp.full}</div>
                    </div>`;
                });

                html += '</div></div>';
            }

            document.getElementById('mobileCalendar').innerHTML = html;
        }

        function renderStats() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const days = getDaysInMonth(year, month);
            
            let totals = { hours: 0, shifts: 0, cleaning: 0, fullCleaning: 0 };
            let rows = '';
            
            employees.forEach(emp => {
                let s = { hours: 0, shifts: 0, cleaning: 0, fullCleaning: 0, off: 0, vacation: 0, sick: 0 };
                for (let d = 1; d <= days; d++) {
                    const shift = shifts[`${emp.id}_${year}-${month}-${d}`];
                    if (shift) {
                        if (shift.type === 'work') {
                            s.hours += shift.hours;
                            s.shifts++;
                            if (shift.cleaning === 'cleaning') s.cleaning++;
                            else if (shift.cleaning === 'fullCleaning') s.fullCleaning++;
                        } else s[shift.type]++;
                    }
                }
                totals.hours += s.hours;
                totals.shifts += s.shifts;
                totals.cleaning += s.cleaning;
                totals.fullCleaning += s.fullCleaning;
                
                rows += `<tr>
                    <td><span style="color:${emp.color}">‚óè</span> ${emp.name}</td>
                    <td><strong>${s.shifts}</strong></td><td><strong>${s.hours}</strong></td>
                    <td>${s.cleaning || '-'}</td><td>${s.fullCleaning || '-'}</td>
                    <td>${s.off || '-'}</td><td>${s.vacation || '-'}</td><td>${s.sick || '-'}</td>
                </tr>`;
            });
            
            document.getElementById('statsTableBody').innerHTML = rows;
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card"><h3>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3><div class="value">${employees.length}</div></div>
                <div class="stat-card"><h3>–°–º–µ–Ω</h3><div class="value">${totals.shifts}</div></div>
                <div class="stat-card"><h3>–ß–∞—Å–æ–≤</h3><div class="value">${totals.hours}</div></div>
                <div class="stat-card"><h3>–£–±–æ—Ä–æ–∫</h3><div class="value">${totals.cleaning}</div></div>
                <div class="stat-card"><h3>–ü–æ–ª–Ω.—É–±.</h3><div class="value">${totals.fullCleaning}</div></div>
                <div class="stat-card"><h3>–°—Ä.—á–∞—Å–æ–≤</h3><div class="value">${employees.length ? Math.round(totals.hours / employees.length) : 0}</div></div>
            `;
        }

        // ==================== MODAL ====================
        function selectCleaning(type) {
            selectedCleaning = type;
            document.querySelectorAll('.cleaning-option').forEach(el => el.classList.remove('active'));
            document.querySelector(`.cleaning-option.${type === 'none' ? 'none' : type}`).classList.add('active');
        }

        function openShiftModal(empId, year, month, day) {
            selectedCell = { empId, year, month, day };
            const emp = employees.find(e => e.id === empId);
            document.getElementById('modalInfo').textContent = `${emp.name} ‚Äî ${day} ${monthNamesShort[month]}`;
            
            const key = `${empId}_${year}-${month}-${day}`;
            const shift = shifts[key];
            
            if (shift?.type === 'work') {
                document.getElementById('modalHours').value = shift.hours;
                selectCleaning(shift.cleaning || 'none');
            } else {
                document.getElementById('modalHours').value = settings.defaultHours || 10;
                selectCleaning('none');
            }
            
            document.getElementById('shiftModal').classList.add('active');
            setTimeout(() => document.getElementById('modalHours').select(), 150);
        }

        function closeModal() {
            document.getElementById('shiftModal').classList.remove('active');
            selectedCell = null;
        }

        document.getElementById('shiftModal').addEventListener('click', e => {
            if (e.target.id === 'shiftModal') closeModal();
        });

        document.getElementById('modalHours').addEventListener('keypress', e => {
            if (e.key === 'Enter') { e.preventDefault(); saveWorkShift(); }
        });

        // ==================== SECTIONS ====================
        function showSection(section) {
            if (!isMobile) return;
            document.querySelectorAll('.mobile-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden-mobile'));
            
            const map = { calendar: 'sectionCalendar', employees: 'sectionEmployees', stats: 'sectionStats' };
            document.getElementById(map[section]).classList.remove('hidden-mobile');
            document.querySelector(`.mobile-tab[onclick="showSection('${section}')"]`).classList.add('active');
        }

        // ==================== TOAST ====================
        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = 'toast' + (isError ? ' error' : '');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // ==================== EXPORT ====================
        function exportToExcel() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const days = getDaysInMonth(year, month);
            const wb = XLSX.utils.book_new();

            const data = [[`–ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω - ${monthNames[month]} ${year}`], []];
            const header = ['–°–æ—Ç—Ä—É–¥–Ω–∏–∫'];
            for (let d = 1; d <= days; d++) header.push(`${d} ${dayNames[getDayOfWeek(year, month, d)]}`);
            header.push('–ß–∞—Å–æ–≤');
            data.push(header);

            employees.forEach(emp => {
                const row = [emp.name];
                let total = 0;
                for (let d = 1; d <= days; d++) {
                    const shift = shifts[`${emp.id}_${year}-${month}-${d}`];
                    row.push(getShiftDisplay(shift).label);
                    if (shift?.type === 'work') total += shift.hours;
                }
                row.push(total);
                data.push(row);
            });

            const ws = XLSX.utils.aoa_to_sheet(data);
            ws['!cols'] = [{ wch: 18 }, ...Array(days).fill({ wch: 5 }), { wch: 7 }];
            XLSX.utils.book_append_sheet(wb, ws, '–ì—Ä–∞—Ñ–∏–∫');
            XLSX.writeFile(wb, `–°–º–µ–Ω—ã_${monthNamesShort[month]}_${year}.xlsx`);
            showToast('üìä –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
        }

        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
    </script>
</body>
</html>
